df_1k_num %>%
pivot_longer(cols = 1:6, names_to = "variable", values_to = "value") %>%
ggplot(aes(value)) +
facet_wrap(~variable, scales = "free") +
geom_density() +
geom_histogram(aes(y = after_stat(density)), bins = 40, alpha = 0.2, fill = "lightblue", color = "darkgreen")
corr_matrix <- cor(df_1k_num)
corrplot(corr_matrix,
type = "lower",
order = "hclust",
tl.col = "blue",
addCoef.col = "white",
diag = FALSE,
title = "Corrplot",
mar = c(0, 0, 1, 0),
col = brewer.pal(10, "RdYlBu"))
set.seed(321)
sample_1k_train <- df_1k_num$Total.Revenue %>%
createDataPartition(p = 0.8, list = FALSE)
df_train_1k  <- df_1k_num[sample_1k_train, ]
df_test_1k <- df_1k_num[-sample_1k_train, ]
model<- lm(Total.Revenue~., data=df_train_1k )
vif_values<-car::vif(model)
print(vif_values)
df_1k_norm <- df_1k %>%
mutate(
`Order.Date` =  mdy(`Order.Date`),  # Convert to Date using lubridate's mdy function
`Ship.Date` = mdy(`Ship.Date`),
`Sales.Channel` = as.factor(`Sales.Channel`),
`Order.Priority` = as.factor(`Order.Priority`),
`Item.Type` = as.factor(`Item.Type`),
`Region` = as.factor(`Region`),
`Country` = as.factor(`Country`),
`Order.ID` = as.character(`Order.ID`)
) %>%
predict(preProcess(., method = c("center", "scale")), .)
levels(df_1k_norm$Sales.Channel)
df_1k_norm %>%
keep(is.numeric) %>%
describe(fast=TRUE) %>%
select(-c(vars,n))
#distribution
df_1k_norm %>%
keep(is.numeric) %>%
gather(variable, value, 1:6) %>%
ggplot(aes(value)) +
facet_wrap(~variable, scales = "free") +
geom_density() +
geom_histogram(aes(y=after_stat(density)), alpha=0.2, fill = "lightblue",
color="darkgreen", position="identity",bins = 40)
df_1k_norm <- df_1k_norm %>%
select(-c(Country,Order.ID,))
library(caret)
library(corrplot)
library(e1071)
library(ggplot2)
library(ggforce)
library(labelled)
library(lubridate)
library(mlbench)
library(ModelMetrics)
library(psych)
library(pROC)
library(randomForest)
library(readr)
library(RColorBrewer)
library(rpart)
library(rpart.plot)
library(tidymodels)
library(tidyverse)
df_1k<-read.csv("https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/1000%20Sales%20Records.csv")
head(df_1k)
describe(df_1k)
str(df_1k)
summary(df_1k)
glimpse(df_1k)
look_for(df_1k)
apply(df_1k, 2, function(x) sum(is.na(x)))
unique(df_1k$Region)
#unique(df_1k$Country)
length(unique(df_1k$Country))
table(df_1k$Item.Type)
table(df_1k$Sales.Channel)
unique(df_1k$Order.Priority)
#select numeric columns 1k
df_1k_num <- df_1k %>%
keep(is.numeric)
#stats
describe(df_1k_num, fast=TRUE) %>%
select(c(-vars,-n))
#distributions
df_1k_num %>%
pivot_longer(cols = 1:6, names_to = "variable", values_to = "value") %>%
ggplot(aes(value)) +
facet_wrap(~variable, scales = "free") +
geom_density() +
geom_histogram(aes(y = after_stat(density)), bins = 40, alpha = 0.2, fill = "lightblue", color = "darkgreen")
corr_matrix <- cor(df_1k_num)
corrplot(corr_matrix,
type = "lower",
order = "hclust",
tl.col = "blue",
addCoef.col = "white",
diag = FALSE,
title = "Corrplot",
mar = c(0, 0, 1, 0),
col = brewer.pal(10, "RdYlBu"))
set.seed(321)
sample_1k_train <- df_1k_num$Total.Revenue %>%
createDataPartition(p = 0.8, list = FALSE)
df_train_1k  <- df_1k_num[sample_1k_train, ]
df_test_1k <- df_1k_num[-sample_1k_train, ]
model<- lm(Total.Revenue~., data=df_train_1k )
vif_values<-car::vif(model)
print(vif_values)
df_1k_norm <- df_1k %>%
mutate(
`Order.Date` =  mdy(`Order.Date`),  # Convert to Date using lubridate's mdy function
`Ship.Date` = mdy(`Ship.Date`),
`Sales.Channel` = as.factor(`Sales.Channel`),
`Order.Priority` = as.factor(`Order.Priority`),
`Item.Type` = as.factor(`Item.Type`),
`Region` = as.factor(`Region`),
`Country` = as.factor(`Country`),
`Order.ID` = as.character(`Order.ID`)
) %>%
predict(preProcess(., method = c("center", "scale")), .)
levels(df_1k_norm$Sales.Channel)
df_1k_norm %>%
keep(is.numeric) %>%
describe(fast=TRUE) %>%
select(-c(vars,n))
#distribution
df_1k_norm %>%
keep(is.numeric) %>%
gather(variable, value, 1:6) %>%
ggplot(aes(value)) +
facet_wrap(~variable, scales = "free") +
geom_density() +
geom_histogram(aes(y=after_stat(density)), alpha=0.2, fill = "lightblue",
color="darkgreen", position="identity",bins = 40)
df_1k_norm <- df_1k_norm %>%
select(-c(Country,Order.ID,))
set.seed(1234)
df1k_norm1 <- df1k_norm
set.seed(1234)
df_1k_norm1 <- df_1k_norm
#split
training.samples <- df_1k_norm1$Total.Revenue %>%
createDataPartition(p = 0.8, list = FALSE)
train_df  <- df_1k_norm1[training.samples, ]
test_df <- df_1k_norm1[-training.samples, ]
svm_model<-svm(formula = Total.Revenue ~ ., data = train_df,
type = 'eps-regression')
print(svm_model)
set.seed(1234)
df_1k_norm_svm <- df_1k_norm
#split
training.samples <- df_1k_norm_svm$Total.Revenue %>%
createDataPartition(p = 0.8, list = FALSE)
train_df  <- df_1k_norm_svm[training.samples, ]
test_df <- df_1k_norm_svm[-training.samples, ]
svm_model<-svm(formula = Total.Revenue ~ ., data = train_df,
type = 'eps-regression')
print(svm_model)
library(Amelia)
library(car)
library(caret)
library(corrplot)
library(Cubist)
library(DataExplorer)
library(dplyr)
library(e1071)
library(earth)
library(forcats)
library(forecast)
library(fpp3)
library(gbm)
library(ggplot2)
library(ggforce)
library(gridExtra)
library(kableExtra)
library(MASS)
library(Metrics)
library(mice)
library(mlbench)
library(party)
library(psych)
library(pROC)
library(randomForest)
library(RANN)
library(RColorBrewer)
library(readr)
library(readxl)
library(rpart)
library(rpart.plot)
library(stringr)
library(summarytools)
library(tidyr)
library(tidymodels)
library(VIM)
library(earth)
library(randomForest)
url_git_2018<-"https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/Underlying%20Cause%20of%20Death%2C%202018%2C%20Single%20Race.txt"
url_git_2019<-"https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/Underlying%20Cause%20of%20Death%2C%202019%2C%20Single%20Race.txt"
url_git_2020<-"https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/Underlying%20Cause%20of%20Death%2C%202020%2C%20Single%20Race.txt"
url_git_2021<-"https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/Underlying%20Cause%20of%20Death%2C%202021%2C%20Single%20Race.txt"
url_git_2022<-"https://raw.githubusercontent.com/GitableGabe/Data624_Data/main/Underlying%20Cause%20of%20Death%2C%202022%2C%20Single%20Race.txt"
cdc_ucd_df_2018 <- as_tibble(read_tsv(url_git_2018,
show_col_types = FALSE)
)%>%
dplyr::select(-1)%>%
rename(Race = `Single Race 6`,
`Race Code` = `Single Race 6 Code`)
cdc_ucd_df_2019 <- as_tibble(read_tsv(url_git_2019,
show_col_types = FALSE)
)%>%
dplyr::select(-1)%>%
rename(Race = `Single Race 6`,
`Race Code` = `Single Race 6 Code`)
cdc_ucd_df_2020 <- as_tibble(read_tsv(url_git_2020,
show_col_types = FALSE)
)%>%
dplyr::select(-1)%>%
rename(Race = `Single Race 6`,
`Race Code` = `Single Race 6 Code`)
cdc_ucd_df_2021 <- as_tibble(read_tsv(url_git_2021,
show_col_types = FALSE)
)%>%
dplyr::select(-1)%>%
rename(Race = `Single Race 6`,
`Race Code` = `Single Race 6 Code`)
cdc_ucd_df_2022 <- as_tibble(read_tsv(url_git_2022,
show_col_types = FALSE)
)%>%
dplyr::select(-1)%>%
rename(Race = `Single Race 6`,
`Race Code` = `Single Race 6 Code`)
cdc_ucd_df <- bind_rows(cdc_ucd_df_2018,
cdc_ucd_df_2020,
cdc_ucd_df_2021,
cdc_ucd_df_2022)
rm(list = ls()[!grepl("cdc_ucd_df$", ls())])
glimpse(cdc_ucd_df)
describe(cdc_ucd_df)
summary(cdc_ucd_df)
apply(cdc_ucd_df, 2, function(x) sum(is.na(x)))
data.frame(missing = colSums(is.na(cdc_ucd_df))) |>
filter(missing == 0) |>
rownames()
plot_missing(cdc_ucd_df,
missing_only = T,
ggtheme = theme_classic(),
theme_config = list(legend.position = c("right")),
geom_label_args = list("size" = 3, "label.padding" = unit(0.1, "lines")))
VIM::aggr(cdc_ucd_df, numbers=T, sortVars=T, bars = FALSE,
cex.axis = .6)
cdc_ucd_df<-na.omit(cdc_ucd_df)
# kable(cdc_ucd_df$`Cause of death`, format = "html", row.names = TRUE) %>%
#   kable_styling(full_width = FALSE)
DataExplorer::plot_histogram(cdc_ucd_df, nrow = 4L, ncol = 4L, ggtheme = theme_classic())
# Create bar plot for gender distribution
ggplot(cdc_ucd_df, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution", x = "Gender", y = "Frequency") +
theme_minimal() +  # Change the theme to minimal
theme(legend.position = "none") +  # Remove legend
scale_fill_manual(values = c("Male" = "skyblue",
"Female" = "pink"))  # Custom fill colors
# Create bar plot for race distribution
ggplot(cdc_ucd_df, aes(x = str_wrap(`Race`, width = 10),
fill = `Race`)) +
geom_bar() +
labs(title = "Race Distribution", x = "Race", y = "Frequency") +
theme_minimal() +  # Change the theme to minimal
theme(legend.position = "none",
axis.text.x = element_text(angle = 45,
hjust = 1)) +  # Remove legend
scale_fill_manual(values = c("Asian" = "lightgreen",
"Black" = "lightblue",
"White" = "lightcoral"))  # Custom fill colors
# Calculate frequency of each cause of death
top_10_ca_freq<- table(cdc_ucd_df$`Cause of death`)
# Select the top 10 causes of death
top_10_ca <- names(sort(top_10_ca_freq, decreasing = TRUE))[1:10]
# Filter data to include only the top 10 causes of death
top_10_ca_data <- subset(cdc_ucd_df, `Cause of death` %in% top_10_ca)
# Create the plot with sorted values
ggplot(top_10_ca_data, aes(x = reorder(str_wrap(`Cause of death`, width = 23), -table(`Cause of death`)[`Cause of death`]), fill = `Cause of death`)) +
geom_bar() +
labs(title = "Top 10 Causes of Death", x = "Cause", y = "Frequency") +
theme_minimal() +  # Change the theme to minimal
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +   # Rotate x-axis labels by 45 degrees
coord_flip()
# Calculate frequency of each cause of death by race
ca_freq_rc <- table(cdc_ucd_df$Race, cdc_ucd_df$`Cause of death`,
cdc_ucd_df$Gender)
# Convert the frequency table to a data frame
ca_freq_rc_df <- as.data.frame.table(ca_freq_rc)
# Rename columns
names(ca_freq_rc_df) <- c("Race", "Cause","Gender", "Frequency")
# Sort by frequency in descending order
ca_freq_rc_df <-
ca_freq_rc_df[order(ca_freq_rc_df$Frequency,
decreasing = TRUE),]
unique(cdc_ucd_df$Gender)
# Filter to keep only the top 3 causes of death for each race
top_3_causes <- do.call(rbind,
lapply(split(ca_freq_rc_df,
list(ca_freq_rc_df$Race, ca_freq_rc_df$Gender)),
function(x) {
race_gender <- unique(x$Race)[1]
gender <- unique(x$Gender)[1]
head(x[order(-x$Frequency), ], 3)
}))
top_3_causes_m <- subset(top_3_causes, Gender == "Male")
top_3_causes_f <- subset(top_3_causes, Gender == "Female")
top_3_causes_o <- subset(top_3_causes, Gender == "NA")
# Create the plot for males
ggplot(top_3_causes_m, aes(x = Race, y = Frequency, fill = Cause)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Top 3 Causes of Death by Race (Males)", x = "Race", y = "Frequency") +
theme_minimal() +
theme(legend.position = "bottom") +  # Position the legend at the bottom
scale_fill_discrete(labels = function(x) str_wrap(x, width = 10))+
# Manually wrap legend labels
coord_flip()
# Create the plot for females
ggplot(top_3_causes_f, aes(x = Race, y = Frequency, fill = Cause)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Top 3 Causes of Death by Race (Female)", x = "Race", y = "Frequency") +
theme_minimal() +
theme(legend.position = "bottom") +  # Position the legend at the bottom
scale_fill_discrete(labels = function(x) str_wrap(x, width = 10))+
# Manually wrap legend labels
coord_flip()
# Create the plot for females
ggplot(top_3_causes_o, aes(x = Race, y = Frequency, fill = Cause)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Top 3 Causes of Death by Race (Niether Male or Female)", x = "Race", y = "Frequency") +
theme_minimal() +
theme(legend.position = "bottom") +  # Position the legend at the bottom
scale_fill_discrete(labels = function(x) str_wrap(x, width = 10))+
# Manually wrap legend labels
coord_flip()
(unreliable_count <- sum(cdc_ucd_df$`Crude Rate` == "Unreliable", na.rm = TRUE))
rm(list = ls()[!grepl("^cdc_ucd", ls())])
cdc_model<-cdc_ucd_df%>%
dplyr::select(-c(`Year Code`,`County Code`, `Race Code`,`Gender Code`,`Cause of death Code`, `Crude Rate`))
cdc_model <- cdc_model %>%
mutate(
County = as.factor(`County`),
Gender = as.factor(Gender),
Race = as.factor(str_trim(Race)),
`Cause of death` = as.factor(`Cause of death`),
Year = as.Date(paste0(Year, "-01-01"))  # Convert Year to Date with January 1st as the date
) %>%
predict(preProcess(., method = c("center", "scale")), .)
# Set seed for reproducibility
set.seed(1234)
#
# # Process the data: trim whitespace and convert to factors
# cdc_model <- cdc_model %>%
#   mutate(
#     County = as.factor(str_trim(County)),
#     Gender = as.factor(str_trim(Gender)),
#     Race = as.factor(str_trim(Race)),
#     `Cause of death` = as.factor(str_trim(`Cause of death`))
#   )
# Remove rows with NA values
cdc_model <- na.omit(cdc_model)
# Split the data
training.samples <- cdc_model$Deaths %>%
createDataPartition(p = 0.8, list = FALSE)
train_df <- cdc_model[training.samples, ]
test_df <- cdc_model[-training.samples, ]
# Identify and remove constant variables in the training set
constant_vars <- sapply(train_df, function(x) length(unique(x)) == 1)
train_df <- train_df[, !constant_vars]
# Ensure the same columns are removed from the test set
test_df <- test_df[, colnames(train_df)]
# Fit the SVM model
svm_model <- svm(formula = Deaths ~ ., data = train_df, type = 'eps-regression')
# Print the SVM model
print(svm_model)
# Predict using the SVM model
predictions_SVM <- predict(svm_model, newdata = test_df)
# Combine predictions with the test dataset
predictions_SVM <- data.frame(Predicted = predictions_SVM, test_df)
# Print predictions
# print(predictions_SVM)
predictions_SVM <- predict(svm_model, newdata = test_df) %>%
bind_cols(test_df)
predictions_SVM$...1 <- as.numeric(predictions_SVM$...1)
MAE <- MAE(predictions_SVM$Deaths, predictions_SVM$...1)
RMSE <- RMSE(predictions_SVM$Deaths, predictions_SVM$...1)
R2 <- R2(predictions_SVM$Deaths, predictions_SVM$...1)
# Create a data frame to store the results
a_svm <- data.frame(Model = "SVM",
MAE = MAE,
RMSE = RMSE,
R2 = R2)
# Print the results
print(a_svm)
# Calculate frequency of each cause of death
top_10_ca_freq<- table(cdc_model$`Cause of death`)
# Select the top 10 causes of death
top_10_ca <- names(sort(top_10_ca_freq, decreasing = TRUE))[1:10]
# Filter data to include only the top 10 causes of death
top_10_ca_data <- subset(cdc_model, `Cause of death` %in% top_10_ca)
top_10_ca_data<-top_10_ca_data%>%
dplyr::select(-Population)
set.seed(1234)
cdc_rf_model <- top_10_ca_data
#split
training_cdc_samples <- cdc_rf_model$Deaths %>%
createDataPartition(p = 0.8, list = FALSE)
train_cdc  <- cdc_rf_model[training_cdc_samples, ]
test_cdc <- cdc_rf_model[-training_cdc_samples, ]
#train using rpart, cp- complexity, smaller # = more complexity,
#method- anova is for regression
tree_cdc <- rpart(Deaths ~., data = train_cdc, cp = 0.004,  method = 'anova')
#visualize
# rpart.plot(tree_cdc)
# print(tree_1k1)
# Open a PNG graphics device
png("tree_cdc.png", width = 1000, height = 600, res=300)  # Adjust width and height as needed
# Plot the tree using rpart.plot
rpart.plot(tree_cdc)
# Close the graphics device and save the plot as "tree_cdc.png"
dev.off()
# Open a PNG graphics device with high resolution
png("tree_cdc_hd.png", width = 2040, height = 1200, res = 300)  # 300 DPI
# Plot the tree using rpart.plot with custom text settings
rpart.plot(tree_cdc, extra = 101, type = 3, under = TRUE,  faclen = 0, varlen = 0, snip = TRUE,
cex = .3, # Increase font size
branch.lty = 1, branch.lwd = .5, # Set branch line type and width
main = "Decision Tree for CDC Data", # Add a main title
split.cex = .5, split.box.col = "lightblue", split.border.col = "blue") # Customize split nodes
# Close the graphics device and save the plot as "tree_cdc_hd.png"
dev.off()
predictions_tree <- predict(tree_cdc, newdata = test_cdc) %>%
bind_cols(test_cdc )
predictions_tree$...1 <- as.numeric(predictions_tree$...1)
decision_tree_model <- data.frame(Model = "Decision Tree 1",
MAE = ModelMetrics::mae(predictions_tree$Deaths, predictions_tree$...1),
#rmse Root Mean Squared Error
RMSE = ModelMetrics::rmse(predictions_tree$Deaths, predictions_tree$...1),
#r squared
R2 = caret::R2(predictions_tree$Deaths, predictions_tree$...1)
)
decision_tree_model
write.csv(my_dataframe, file = "predictions_SVM.csv", row.names = TRUE)
write.csv(predictions_SVM, file = "predictions_SVM.csv", row.names = TRUE)
write.csv(predictions_tree, file = "predictions_tree.csv", row.names = TRUE)
install.packages(c("Amelia", "backports", "brio", "broom", "bslib", "cachem", "callr", "checkmate", "cli", "clock", "colorspace", "corrplot", "cpp11", "crayon", "Cubist", "curl", "data.table", "DBI", "dbplyr", "dials", "digest", "evaluate", "fable", "fabletools", "farver", "fastmap", "feasts", "forecast", "fpp3", "fs", "future", "future.apply", "gbm", "ggdist", "ggfortify", "ggplot2", "gtable", "hardhat", "highr", "htmltools", "infer", "ipred", "kernlab", "knitr", "labelled", "lhs", "lme4", "magick", "matrixStats", "minqa", "mlbench", "modeldata", "multcomp", "munsell", "mvtnorm", "nloptr", "openssl", "openxlsx", "ordinal", "parallelly", "parsnip", "party", "pbkrtest", "pkgload", "plotmo", "pls", "polyclip", "processx", "prodlim", "ps", "psych", "quantreg", "ragg", "RANN", "Rcpp", "RcppArmadillo", "RcppEigen", "recipes", "renv", "reprex", "rlang", "rmarkdown", "robustbase", "rsample", "rsconnect", "rstudioapi", "sass", "sp", "SparseM", "stringi", "systemfonts", "testthat", "textshaping", "tidymodels", "tidyselect", "tinytex", "tseries", "tsibble", "tune", "ucminf", "urca", "uuid", "waldo", "withr", "workflowsets", "x13binary", "xfun", "xts", "yaml", "yardstick"))
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
# Calculate eigenvalues and eigenvectors
eigen_result<-eigen(A)
# Display eigenvalues
paste("Eigenvalues:", paste(eigen_result$values, collapse = ", "))
# Display eigenvectors
paste("Eigenvectors:", paste(eigen_result$vectors, collapse = ", "))
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
#Define matrix A
A<-
matrix(c(0,4,-1,1,
-2,6,-1,-1,
-2,8,-1,-1,
-1,8,-3,1),nrow=4, byrow=TRUE)
print(A)
# Calculate eigenvalues and eigenvectors
eigen_result<-eigen(A)
# Display eigenvalues
paste("Eigenvalues:", paste(eigen_result$values, collapse = ", "))
# Display eigenvectors
paste("Eigenvectors:", paste(eigen_result$vectors, collapse = ", "))
setwd("C:/Users/xusef/Documents/GitableGabe/DATA 698")
